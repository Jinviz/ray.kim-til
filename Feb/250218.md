# WebSocket (D+16)
## WebSocket
- Socket: 네트워크 상의 두 시스템 간의 통신을 위한 엔드포인트
- WebSocket: 실시간 양방향 통신을 위해 지속적인 연결을 제공하는 프로토콜
- 실시간 양방향 연결임에도 신뢰성과 순서가 보장된다.
- TCP 기반의 통신 프로토콜
- 작동 순서:
1. 클라이언트가 서버에 웹소켓 연결을 요청할 때 먼저 `TCP/IP(3-4계층)`를 통해 신뢰성 있는 연결을 수립
2. 그 다음 `HTTP 핸드셰이크`를 통해 웹소켓 프로토콜로 업그레이드
3. 이후 웹소켓 통신 시작

### 장점
1. 실시간 & 양방향 데이터 전송
2. 연결 유지 비용 감소: 한번만 연결 설정하면 되기 때문에
3. 메세지 경계 존중: 독립적으로 구분되게 경계를 명확하게 하기 때문에 데이터 무결성을 유지시켜줌

## ws와 wss의 차이점
#### ws
- http와 유사하게 암호화 되지 않은 웹소켓 통신 프로토콜
#### wss
- https와 유사하게 SSL/TLS로 암호화된 웹소켓 통신 프로토콜
## 메시지 프레임과 경계
OSI 7계층의 애플리케이션 계층에서의 데이터 전송 단위는 `메세지`이다. 하지만 웹 소켓 통신 프로토콜의 전송 단위는 내부적으로 메세지가 하나 이상의 프레임으로 분할되어 물리적 단위는 `프레임`이다. 웹 소켓이 연결된 이후로 수신측은 프레임을 조합해서 하나의 메세지로 만듦, 애플리케이션에는 완성된 메세지 형태로 전달된다. 연결 종료를 원할 경우 `close 프레임`을 전송하여 종료를 요청한다.
여기서 말하는 `프레임`은 osi 2계층은 전송 단위인 `프레임`과는 다른 것이며, 웹 소켓 자체의 단위이다.

> ### 웹소켓의 데이터 교환 단위는 메시지(Message)입니다. 하지만 내부적으로는 프레임(Frame)들로 분할되어 전송됩니다.
> 구체적으로 설명하면:
> - 메시지(Message) - 논리적 단위
> 1. 응용 프로그램 레벨에서 다루는 완전한 데이터 단위
> 2. 텍스트나 바이너리 데이터로 구성
> 3. 하나 이상의 프레임으로 구성될 수 있음
> - 프레임(Frame) - 물리적 전송 단위
> 1. 웹소켓 프로토콜 내부에서 사용하는 데이터 전송 단위
> 2. 각 프레임은 FIN, RSV1-3, Opcode, MASK, Payload length 등의 제어 비트를 포함
> 3. 대용량 메시지는 여러 프레임으로 분할되어 전송
> 마지막 프레임의 FIN 비트가 1로 설정되어 메시지의 끝을 표시

> 주의: 여기서 말하는 프레임은 OSI 2계층의 데이터링크 계층 프레임과는 다른, 웹소켓 프로토콜 자체의 프레임을 의미합니다.

## Close 프레임의 역할
- 두 애플리케이션 서버 간의 웹 소켓 통신을 정상적으로 종료하기 위해 어느 한쪽에서 종료를 알리는 프레임
- 상대방은 이를 확인하고 연결을 닫는다

## PDU (Protocol data unit)
- 7계층(응용 계층) - 데이터(Data)/메시지(Message)
사용자가 보내고자 하는 실제 데이터

- 6계층(표현 계층) - 데이터(Data)
암호화/압축된 데이터

- 5계층(세션 계층) - 데이터(Data)
통신 관련 데이터

- 4계층(전송 계층) - 세그먼트(Segment)/데이터그램(Datagram)
TCP는 세그먼트, UDP는 데이터그램

- 3계층(네트워크 계층) - 패킷(Packet)
IP 헤더가 붙은 데이터

- 2계층(데이터링크 계층) - 프레임(Frame)
MAC 주소 정보가 붙은 데이터

- 1계층(물리 계층) - 비트(Bit)
1과 0의 전기적 신호
