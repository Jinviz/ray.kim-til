# HTTP 자격증명 헤더, JWT, OAuth (D+11)
## HTTP 자격증명 헤더
- 클라이언트와 서버 간의 인증과정에서 `사용자의 자격`을 확인하기 위해 사용되는 헤더
- 보안이 필요한 웹 리소스에 접근할 때 사용자의 `접근 권한`을 검증하기 위함

> ### 헤더
> `WWW-Authenticate`
> - 서버가 클라이언트에게 인증이 필요함을 알리는 헤더
> - 접근 권한을 요구하는 경우 사용
> - e.g. 클라이언트가 리소스에 접근할 때, '401 Unauthorized' 응답과 'WWW-Authenticate' 헤더를 함께 전송하여 인증 방식 안내
>   
> `Authorization`
> - 클라이언트가 서버에게 자신을 인증하는 정보를 제공하는 헤더
> - 'WWW-Authenticate'을 통해 요구된 인증 방식에 따라 'Authorization'헤더에 인증 정보를 포함해 전송
>
> `프록시 자격증명 헤더`
> - 'Proxy-Authenticate', 'Proxy-Authorization'

### 인증방식
1. 기본 인증 (Basic Authentication)
2. 다이제스트 인증 (Digest Authentication)
3. Bearer토큰 (Bearer Token) - JWT 포함
4. OAuth

### 기본 인증 (Basic Authentication)
- 간단하게 인증할 때 사용 (e.g.토스 라이브러리 API 사용 시)
- ID,Password를 콜론으로 구분 -> base64로 인코딩한 값을 'Authorization' 헤더에 포함하여 서버로 전송# HTTP 자격증명 헤더, JWT, OAuth (D+11)

> base64
> : 6비트 이진 데이터(예를 들어 실행 파일이나, ZIP 파일 등)를 문자 코드에
> 영향을 받지 않는 공통 ASCII 영역의 문자들로만 이루어진 일련의 문자열로 바꾸는 인코딩 방식

### 다이제스트 인증 (Digest Authentication)
- Digest: 내용을 간단히 추린 더 작은 형태의 데이터를 생성하는 것 (e.g. 박물관 티켓)
- 기본 인증 방식의 중간자 공격에 취약한 점을 보완하여, 비밀번호를 직접 전송하지 않고 해시된 버전을 전송하여 보완한 방식
#### 동작 방식
#### a. 클라이언트 인증 요청
  1. (Client) 리소스 접근
  2. (Server) 401 응답, 인증 요구, 헤더에 `nonce` 값과 `realm` 정보 포함
#### b. 클라이언트 응답 생성(서버에 제출)
  1. (Client) 받은 nonce, realm와 ID,PW,요청메소드,URI 등을 사용하여 해시 함수로 계산
  2. (Client) 다이제스트 응답 서버로 전송
#### c. 서버에서 인증 처리
  1. (Server) 전송 받은 'Authorization' 헤더 내의 응답과 서버에서 독립적으로 생성한 해시 값 비교
  2. (Server) 일치하면 요청 승인 및 접근 허용 / 실패하면 401 응답 코드 재전송

> `nonce`
> - Number used once, 요청에 한번만 사용되는 값
> - 서버는 nonce를 임의로 생성하여 `WWW-Authenticate`헤더와 함께 클라이언트로 보냄
> - 재전송 공격을 방지 목적을 가지고 즉, 인증 요청이 재사용되는 것을 방지함
>
> `realm`
> - 사용자가 요구하는 자원에 대한 서비스 범위
> - `WWW-Authenticate`헤더와 함께 클라이언트로 보냄

### 베어러 토큰 (BearerToken)
- Bearer: 토큰을 소지하고 있는 사람이 그 토큰에 기록된 모든 권한을 갖고, 인증된 사용자로 간주됨을 의미함
- 주로 JWT나 OAuth 2.0과 같은 토큰 기반 인증 시스템에서 사용됨
- 클라이언트는 서버로부터 받은 Access 토큰을 Authorization 헤더에 포함하여 리소스 접근 요청을 보냄

## JWT (Json Web Token)
- 애플리케이션 간의 정보 교환을 위해 설계된, 정보를 JSON 형식으로 포함하는 자체 포함형(compact and self-contained) 토큰
> 자체 포함형(compact and self-contained)이란?
> - 모든 필요한 정보가 자체적으로 포함되어있다는 의미
> - JWT가 데이터베이스 조회 없이도 인증을 할 수 있게 독립적을 동작한다는 의미

### 특징
#### 1. 무상태 인증(Stateless Authentication)
: JWT 자체에 사용자 인증 정보와 데이터를 포함하고 있어 서버가 따로 세션을 저장할 필요가 없음. Http 헤더를 통해 전송되므로 추가적인 저장소나 상태가 필요 없음
#### 2. 유연성
: 사용자 인증 외에도 데이터 접근 제어, API 인증 등의 다양한 목적에 활용 가능하다.
#### 3. 무결성
: 서버가 서명을 검증하여 변조되지 않았음을 확인할 수 있음. 신뢰성이 유지됨

### ❕ Access 토큰만 사용할 때 고려사항
- 보안상의 이유로 유효기간이 존재함
- 탈취되면 유효기간동안 리소스 접근이 가능하기 때문에, HTTPS와 같은 보안 프로토콜을 사용하여 데이터 암호화를 해야 함

### ❕ Access 토큰과 Refresh 토큰을 함께 사용
- Refresh 토큰으로 인하여 자주 로그인할 필요없어져 사용자 경험 향상
- 리프레시 토큰은 엑세스 토큰보다 더 안전하게 저장되어 보완성 향상

### JWT 구성 요소 (3가지)
1.Header
- 토큰의 유형(typ): JWT임을 명시
- 서명 알고리즘(alg): 서명에 쓰인 알고리즘
2.Payload
- 토큰에 담길 정보(사용자 정보, 추가 메타데이터 등)
3.Signature
- 헤더와 페이로드를 합친 뒤, 지정된 알고리즘으로 해시하고, 비밀키를 사용하여 서명한 결과

### ❕ 세션 기반 인증과 JWT 인증 비교
- 세션 기반
장점: 상태유지(서버 메모리 또는 DB에 로그인 상태 저장)
단점: 스케일링 문제(서버에 저장하기 때문)

- JWT 기반
장점: 정보 내장(자체포함형)으로 상태 유지 필요 없음(부함감소), 유연성(활용도 높음)
단점: 토큰 탈취 시 위험, 서버에서 강제로 만료 못 시킴, 세션보다 크기 큼


### ❕ (JWT + 세션 )혼합 구현 방식
1. JWT + 서버 세션
2. 단기 JWT + 장기 세션
### ❕ JWT 취약점 및 해결책


